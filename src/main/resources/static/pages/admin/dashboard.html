<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Admin</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Stylesheets -->
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/modal.css">
    <link rel="stylesheet" href="../../css/toast.css">
</head>

<body>
    <div class="sidebar">
        <h3>Quản trị hệ thống</h3>
        <a href="dashboard.html" class="active">Quản lý người dùng</a>
        <a href="#" onclick="handleLogout(); return false;">Đăng xuất</a>
    </div>

    <div class="main-content">
        <h1 style="text-align: center; margin-bottom: 30px;">Danh sách tài khoản</h1>



        <!-- User List Table with Integrated Search/Filter -->
        <div class="card" style="padding: 0; overflow: visible;">
            <div class="table-header-sticky">
                <div class="table-title-section">
                    <button class="btn-primary btn-sm" onclick="ModalManager.open('create-user-modal')"
                        style="min-width: 180px; min-height: 50px;">
                        + Tạo tài khoản mới
                    </button>
                </div>
                <div class="search-filter-compact">
                    <input type="text" id="search-input" placeholder="Nhập họ và tên" onkeyup="filterUsers()"
                        class="search-input-compact">
                    <select id="role-filter" onchange="handleRoleFilterChange()" class="filter-select-compact">
                        <option value="">Vai trò</option>
                        <option value="REGIONAL_MANAGER">Quản lý khu vực</option>
                        <option value="BRANCH_MANAGER">Quản lý chi nhánh</option>
                        <option value="ADMIN">Quản trị hệ thống</option>
                        <option value="RECEPTIONIST">Lễ tân</option>
                        <option value="HOUSEKEEPER">Buồng phòng</option>
                    </select>
                    <select id="city-filter" onchange="handleCityFilterChange()" class="filter-select-compact">
                        <option value="">Thành phố</option>
                        <option value="Hà Nội">Hà Nội</option>
                        <option value="Hồ Chí Minh">Hồ Chí Minh</option>
                        <option value="Đà Nẵng">Đà Nẵng</option>
                        <option value="Phú Quốc">Phú Quốc</option>
                    </select>
                    <select id="branch-filter" onchange="filterUsers()" class="filter-select-compact">
                        <option value="">Chi nhánh</option>
                    </select>
                </div>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tên đăng nhập</th>
                        <th>Họ tên</th>
                        <th>Vai trò</th>
                        <th>Thành phố</th>
                        <th>Chi nhánh</th>
                        <th style="width: 50px;"></th>
                    </tr>
                </thead>
                <tbody id="users-tbody">
                    <tr>
                        <td colspan="7" style="text-align: center;">Đang tải dữ liệu...</td>
                    </tr>
                </tbody>
            </table>
            <!-- Pagination Controls -->
            <div class="pagination-container" id="pagination-container" style="display: none;">
                <div class="pagination-info" id="pagination-info">
                    Hiển thị 1-10 trong số 50 tài khoản
                </div>
                <div class="pagination-controls" id="pagination-controls">
                    <!-- Pagination buttons will be generated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Create User -->
    <div class="modal-backdrop" id="create-user-modal-backdrop">
        <div class="modal" id="create-user-modal">
            <div class="modal-header">
                <h2>Tạo tài khoản mới</h2>
                <button class="modal-close" onclick="ModalManager.close('create-user-modal')">&times;</button>
            </div>
            <form id="create-user-form" onsubmit="handleCreateUser(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label>Tên đăng nhập *</label>
                        <input type="text" name="username" required minlength="3" maxlength="20" pattern="[a-zA-Z0-9]+"
                            title="Chỉ chữ cái và số, không dấu">
                    </div>

                    <div class="form-group">
                        <label>Mật khẩu *</label>
                        <input type="password" name="password" required minlength="8" title="Tối thiểu 8 ký tự">
                    </div>

                    <div class="form-group">
                        <label>Họ và tên *</label>
                        <input type="text" name="fullName" required>
                    </div>

                    <div class="form-group">
                        <label>Vai trò *</label>
                        <select name="role" id="role-select" required onchange="handleRoleChange()">
                            <option value="">-- Chọn vai trò --</option>
                            <option value="REGIONAL_MANAGER">Lãnh đạo khu vực (Regional Manager)</option>
                            <option value="BRANCH_MANAGER">Quản lý chi nhánh (Branch Manager)</option>
                            <option value="ADMIN">Quản trị hệ thống (Admin)</option>
                            <option value="RECEPTIONIST">Lễ tân (Receptionist)</option>
                            <option value="HOUSEKEEPER">Buồng phòng (Housekeeper)</option>
                        </select>
                    </div>

                    <div class="form-group" id="city-group">
                        <label>Thành phố *</label>
                        <select name="city">
                            <option value="">-- Chọn thành phố --</option>
                            <option value="Hà Nội">Hà Nội</option>
                            <option value="Hồ Chí Minh">Hồ Chí Minh</option>
                            <option value="Đà Nẵng">Đà Nẵng</option>
                            <option value="Đà Lạt">Đà Lạt</option>
                            <option value="Phú Quốc">Phú Quốc</option>
                        </select>
                    </div>

                    <div class="form-group" id="branch-group">
                        <label>Chi nhánh</label>
                        <input type="text" name="branchName" placeholder="VD: Ba Đình Hotel">
                    </div>

                    <div class="form-group">
                        <label>Ngày sinh</label>
                        <input type="date" name="birthday">
                    </div>

                    <div class="form-group">
                        <label>Số điện thoại</label>
                        <input type="tel" name="phoneNumber" pattern="[0-9]{10}" placeholder="VD: 0901234567">
                    </div>

                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                        onclick="ModalManager.close('create-user-modal')">Hủy</button>
                    <button type="submit" class="btn btn-primary">Tạo tài khoản</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Edit User -->
    <div class="modal-backdrop" id="edit-user-modal-backdrop">
        <div class="modal" id="edit-user-modal">
            <div class="modal-header">
                <h2>Chỉnh sửa tài khoản</h2>
                <button class="modal-close" onclick="ModalManager.close('edit-user-modal')">&times;</button>
            </div>
            <form id="edit-user-form" onsubmit="handleEditUser(event)">
                <input type="hidden" name="id" id="edit-user-id">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tên đăng nhập *</label>
                            <input type="text" id="edit-username" name="username" required minlength="3" maxlength="20"
                                pattern="[a-zA-Z0-9]+" title="Chỉ chữ cái và số, không dấu" readonly>
                        </div>
                        <div class="form-group">
                            <label>Họ và tên *</label>
                            <input type="text" id="edit-fullName" name="fullName" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Vai trò *</label>
                            <select id="edit-role" name="role" required onchange="handleEditRoleChange()">
                                <option value="">-- Chọn vai trò --</option>
                                <option value="REGIONAL_MANAGER">Lãnh đạo khu vực</option>
                                <option value="BRANCH_MANAGER">Quản lý chi nhánh</option>
                                <option value="ADMIN">Quản trị hệ thống</option>
                                <option value="RECEPTIONIST">Lễ tân</option>
                                <option value="HOUSEKEEPER">Buồng phòng</option>
                            </select>
                        </div>
                        <div class="form-group" id="edit-city-group">
                            <label>Thành phố *</label>
                            <select id="edit-city" name="city">
                                <option value="">-- Chọn thành phố --</option>
                                <option value="Hà Nội">Hà Nội</option>
                                <option value="Hồ Chí Minh">Hồ Chí Minh</option>
                                <option value="Đà Nẵng">Đà Nẵng</option>
                                <option value="Phú Quốc">Phú Quốc</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" id="edit-branch-group">
                            <label>Chi nhánh</label>
                            <input type="text" id="edit-branchName" name="branchName" placeholder="VD: Ba Đình Hotel">
                        </div>
                        <div class="form-group">
                            <label>Ngày sinh</label>
                            <input type="date" id="edit-birthday" name="birthday">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Số điện thoại</label>
                            <input type="tel" id="edit-phoneNumber" name="phoneNumber" pattern="[0-9]{10}"
                                placeholder="VD: 0901234567">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="edit-email" name="email">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                        onclick="ModalManager.close('edit-user-modal')">Hủy</button>
                    <button type="submit" class="btn btn-primary">Cập nhật</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div class="modal-backdrop" id="confirm-delete-modal-backdrop">
        <div class="modal confirm-modal" id="confirm-delete-modal">
            <div class="modal-header">
                <h2>Xác nhận xóa</h2>
                <button class="modal-close" onclick="ModalManager.close('confirm-delete-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-message">Bạn có chắc muốn xóa tài khoản này?</div>
                <div class="modal-detail" id="confirm-delete-detail">
                    Tài khoản "<span id="delete-username"></span>" sẽ bị xóa vĩnh viễn và không thể khôi phục.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="ModalManager.close('confirm-delete-modal')">
                    Hủy
                </button>
                <button type="button" class="btn btn-danger" id="confirm-delete-btn">
                    Xóa tài khoản
                </button>
            </div>
        </div>
    </div>

    <script src="../../js/common/toast.js"></script>
    <script src="../../js/common/config.js"></script>
    <script src="../../js/common/auth.js"></script>
    <script src="../../js/common/modal.js"></script>
    <script src="../../js/admin/user_management.js"></script>
</body>

</html>