<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tạo Đặt Phòng Mới</title>
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <div class="login-container" style="width: 500px; margin: 50px auto;">
        <h2>Tạo Booking Mới</h2>
        <form id="bookingForm">
            <div class="form-group">
                <label>Tên Khách Hàng:</label>
                <input type="text" id="customerName" required placeholder="Nhập tên khách...">
            </div>
            
            <div class="form-group">
                <label>Chọn Phòng (ID):</label>
                <input type="number" id="roomId" required placeholder="Nhập ID phòng (VD: 1, 2...)">
            </div>

            <div class="form-group">
                <label>Ngày Check-in:</label>
                <input type="datetime-local" id="checkInDate" required>
            </div>

            <div class="form-group">
                <label>Ngày Check-out:</label>
                <input type="datetime-local" id="checkOutDate" required>
            </div>

            <button type="submit" class="btn-primary">Xác Nhận Đặt</button>
            <button type="button" onclick="window.location.href='booking-list.html'" style="margin-top: 10px; background: #6c757d; color: white; width: 100%; border: none; padding: 10px; border-radius: 4px; cursor: pointer;">Hủy & Quay Lại</button>
        </form>
    </div>

    <script src="../../js/common/config.js"></script>
    <script src="../../js/common/utils.js"></script>
    <script>
        document.getElementById('bookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Lấy dữ liệu từ form
            const requestData = {
                customerName: document.getElementById('customerName').value,
                roomId: parseInt(document.getElementById('roomId').value),
                checkInDate: document.getElementById('checkInDate').value, // Format mặc định của input này đã chuẩn ISO 8601
                checkOutDate: document.getElementById('checkOutDate').value
            };

            // Validate cơ bản
            if(new Date(requestData.checkInDate) >= new Date(requestData.checkOutDate)) {
                alert("Ngày Check-out phải sau ngày Check-in!");
                return;
            }

            try {
                // Gọi API POST /bookings
                await callAPI('/bookings', 'POST', requestData);
                alert("✅ Đặt phòng thành công!");
                window.location.href = "booking-list.html"; // Quay lại danh sách
            } catch (error) {
                alert("❌ Lỗi đặt phòng: " + error.message);
            }
        });
    </script>
</body>
</html>